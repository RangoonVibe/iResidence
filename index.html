<script>
let page = 1;
const maxPages = 7;

const viewer = document.getElementById("viewer");
const currentPage = document.getElementById("currentPage");
const nextPage = document.getElementById("nextPage");

function setPage(el, num) {
    el.style.backgroundImage = `url('page${num}.png')`;
}

// initial
setPage(currentPage, page);

let animating = false;

// slide forward
function next() {
    if (animating) return;
    animating = true;

    let nextNum = page + 1;
    if (nextNum > maxPages) nextNum = 1;

    setPage(nextPage, nextNum);

    nextPage.style.transform = "translateX(100%)";
    requestAnimationFrame(() => {
        currentPage.style.transform = "translateX(-100%)";
        nextPage.style.transform = "translateX(0)";
    });

    setTimeout(() => {
        page = nextNum;
        setPage(currentPage, page);
        currentPage.style.transform = "translateX(0)";
        animating = false;
    }, 800);
}

// slide backward
function prev() {
    if (animating) return;
    animating = true;

    let prevNum = page - 1;
    if (prevNum < 1) prevNum = maxPages;

    setPage(nextPage, prevNum);

    nextPage.style.transform = "translateX(-100%)";
    requestAnimationFrame(() => {
        currentPage.style.transform = "translateX(100%)";
        nextPage.style.transform = "translateX(0)";
    });

    setTimeout(() => {
        page = prevNum;
        setPage(currentPage, page);
        currentPage.style.transform = "translateX(0)";
        animating = false;
    }, 800);
}

// swipe support
let startX = 0;

viewer.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
}, { passive: true });

viewer.addEventListener("touchend", e => {
    const dx = e.changedTouches[0].clientX - startX;
    if (Math.abs(dx) < 30) return;
    dx > 0 ? prev() : next();
}, { passive: true });

// click support
viewer.addEventListener("click", e => {
    const x = e.clientX / window.innerWidth;
    x < 0.5 ? prev() : next();
});
</script>
